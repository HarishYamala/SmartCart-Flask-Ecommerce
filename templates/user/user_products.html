{% extends "user/base.html" %}

{% block title %}SmartCart - Products{% endblock %}

{% block extra_css %}
<link rel="stylesheet"
      href="{{ url_for('static', filename='css/products.css') }}">
{% endblock %}

{% block content %}

<!-- FILTER BAR -->
<div class="filter-bar">
    <form method="GET" class="filter-form">

        <select name="category">
            <option value="">All Categories</option>
            {% for cat in categories %}
            <option value="{{ cat.category }}"
                {% if request.args.get('category') == cat.category %} selected {% endif %}>
                {{ cat.category }}
            </option>
            {% endfor %}
        </select>

        <button type="submit">Filter</button>
    </form>
</div>

<!-- PRODUCTS -->
<div class="products-container">

    {% for product in products %}
    <div class="product-card">

        <!-- üî• LOW STOCK BADGE -->
        {% if product.quantity > 0 and product.quantity <= 5 %}
            <div class="badge" style="background-color:#ffc107;color:#000;">
                Only {{ product.quantity }} left!
            </div>
        {% else %}
            <div class="badge">Trending</div>
        {% endif %}

        <img src="{{ url_for('static', filename='uploads/product_images/' + product.image) }}"
             alt="{{ product.name }}">

        <div class="rating">
            4.3 ‚≠ê
        </div>

        <h4>{{ product.name }}</h4>

        <p class="price">‚Çπ{{ product.price }}</p>

        <!-- üî• STOCK STATUS -->
        <p style="margin:6px 0;">
            {% if product.quantity > 0 %}
                <span style="color:green;font-weight:600;">
                    In Stock ({{ product.quantity }} left)
                </span>
            {% else %}
                <span style="color:red;font-weight:700;">
                    Out of Stock
                </span>
            {% endif %}
        </p>

        <!-- VIEW PRODUCT BUTTON -->
        <a href="{{ url_for('product_details', product_id=product.product_id) }}"
           class="view-btn">
            View Product
        </a>

    </div>
    {% endfor %}

</div>

{% endblock %}