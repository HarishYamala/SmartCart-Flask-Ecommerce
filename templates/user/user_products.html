{% extends "user/base.html" %}

{% block title %}SmartCart - Products{% endblock %}

{% block extra_css %}
<link rel="stylesheet"
      href="{{ url_for('static', filename='css/products.css') }}">
{% endblock %}

{% block content %}

<!-- FILTER BAR -->
<div class="filter-bar">
    <form method="GET" class="filter-form">

        <select name="category">
            <option value="">All Categories</option>
            {% for cat in categories %}
            <option value="{{ cat.category }}"
                {% if request.args.get('category') == cat.category %} selected {% endif %}>
                {{ cat.category }}
            </option>
            {% endfor %}
        </select>

        <button type="submit">Filter</button>
    </form>
</div>

<!-- PRODUCTS -->
<div class="products-container">

    {% for product in products %}
    <div class="product-card">

        {% if product.quantity > 0 and product.quantity <= 5 %}
            <div class="badge">Only {{ product.quantity }} left!</div>
        {% else %}
            <div class="badge">Trending</div>
        {% endif %}

        <img src="{{ url_for('static', filename='uploads/product_images/' + product.image) }}"
             alt="{{ product.name }}">

        <div class="rating">
            4.3 ⭐
        </div>

        <h4>{{ product.name }}</h4>

        <p class="price">₹{{ product.price }}</p>

        <p class="stock-status">
            {% if product.quantity > 0 %}
                <span class="in-stock">
                    In Stock ({{ product.quantity }} left)
                </span>
            {% else %}
                <span class="out-stock">
                    Out of Stock
                </span>
            {% endif %}
        </p>

        <!-- PRODUCT ACTIONS -->
        <div class="product-actions">

            <a href="{{ url_for('product_details', product_id=product.product_id) }}"
               class="btn-view">
                View
            </a>

            {% if product.quantity > 0 %}
                <form method="POST"
                      action="{{ url_for('add_to_cart', product_id=product.product_id) }}">
                    <button type="submit" class="btn-add">
                        <i class="fa fa-shopping-cart"></i> Add
                    </button>
                </form>
            {% else %}
                <button class="btn-disabled" disabled>
                    Out
                </button>
            {% endif %}

        </div>

    </div>
    {% endfor %}

</div>

{% endblock %}